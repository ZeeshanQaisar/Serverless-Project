metadata:
  name: mq7sensor
  labels:
    nuclio.io/project-name: 1d759c33-b93f-4525-adac-046df6068396
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-mq7sensor:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    mq7Trigger:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.1.181:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/sensors/mq7
  version: 1
  build:
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCdhbXFwbGliJyk7DQp2YXIgdXJsID0gcmVxdWlyZSgndXJsJyk7DQp2YXIgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKTsNCg0KbGV0IGV2ZW50MSA9ICJNUTdfVGVsZWdyYW0iOw0KbGV0IGFwaV9rZXkgPSAiZUI4MFp6XzZ0Tzl6QVJ5bjFNeTNydE1MQ2pRcC0xYUFVX053NGdBZmtEMCI7DQpsZXQgd2FybmluZyA9IHRydWU7DQoNCg0KICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2dnZXIobXNnKXsNCiAgICAgICAgICAgIHZhciBxID0gJ2lvdC9zZW5zb3JzL21xNyc7DQogICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gYXdhaXQgYW1xcC5jb25uZWN0KCdhbXFwOi8vZ3Vlc3Q6Z3Vlc3RAMTkyLjE2OC4xLjE4MTo1NjcyJyk7DQogICAgICAgICAgICBjb25zdCBjaCA9IGF3YWl0IGNvbm5lY3Rpb24uY3JlYXRlQ2hhbm5lbCgpOw0KICAgICAgICAgICAgYXdhaXQgY2guYXNzZXJ0UXVldWUocSwge2R1cmFibGU6IGZhbHNlfSk7DQogICAgICAgICAgICBjaC5zZW5kVG9RdWV1ZShxLCBCdWZmZXIuZnJvbShtc2cpKTsNCiAgICAgICAgIH0NCg0KICAgICAgICAgbGV0IHNlbmRJRlRUVCA9IGFzeW5jIGZ1bmN0aW9uKGV2ZW50LCBrZXksIHZhbHVlMSwgdmFsdWUyLCB2YWx1ZTMpew0KICAgICAgICAgICAgdmFyIHBvc191cmwgPSBgaHR0cHM6Ly9tYWtlci5pZnR0dC5jb20vdHJpZ2dlci9NUTdfVGVsZWdyYW0vd2l0aC9rZXkvZUI4MFp6XzZ0Tzl6QVJ5bjFNeTNydE1MQ2pRcC0xYUFVX053NGdBZmtEMGA7DQogICAgICAgICAgICBsZXQgcG9zdERhdGEgPSBKU09OLnN0cmluZ2lmeSh7IHZhbHVlMSwgdmFsdWUyLCB2YWx1ZTMgfSk7DQoNCiAgICAgICAgICAgIHZhciBwYXJzZWRVcmwgPSB1cmwucGFyc2UocG9zX3VybCk7DQogICAgICAgICAgICB2YXIgcG9zdF9vcHRpb25zID0gew0KICAgICAgICAgICAgICAgIGhvc3RuYW1lOiBwYXJzZWRVcmwuaG9zdG5hbWUsDQogICAgICAgICAgICAgICAgcG9ydDogcGFyc2VkVXJsLnBvcnQsDQogICAgICAgICAgICAgICAgcGF0aDogcGFyc2VkVXJsLnBhdGgsDQogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsDQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLA0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1MZW5ndGgnOiBwb3N0RGF0YS5sZW5ndGgNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9OyANCiAgICAgICAgICAgIHZhciBwb3N0X3JlcSA9IGh0dHAucmVxdWVzdChwb3N0X29wdGlvbnMsIGZ1bmN0aW9uKHJlcykgew0KICAgICAgICAgICAgcmVzLnNldEVuY29kaW5nKCd1dGY4Jyk7DQogICAgICAgICAgICByZXMub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmVzcG9uc2U6ICcgKyBjaHVuayk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gVHJpZ2dlciBhIFBPU1QgdG8gdGhlIHVybCB3aXRoIHRoZSBib2R5Lg0KICAgICAgICBwb3N0X3JlcS53cml0ZShwb3N0RGF0YSk7DQogICAgICAgIHBvc3RfcmVxLmVuZCgpOw0KICAgIH0gICANCg0KICAgICAgICBleHBvcnRzLmhhbmRsZXIgPSBmdW5jdGlvbihjb250ZXh0LCBldmVudCkgew0KICAgICAgICAgICAgdmFyIF9ldmVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsNCiAgICAgICAgICAgIHZhciBfZGF0YSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uX2V2ZW50LmJvZHkuZGF0YSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrICIrX2RhdGEpOw0KICAgICAgICAgICAgbG9nZ2VyKCJDYXJib25Nb25PeGlkZSBWYWx1ZSA6ICIrX2RhdGEpOw0KICAgICAgICAgICAgDQogICAgICAgICAgIGlmKChfZGF0YT4xNTApKXsNCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc2VuZElGVFRUKGV2ZW50MSwgYXBpX2tleSwgIntXYXJuaW5nOlZhbHVlIGlzIHF1aXRlIEhpZ2ggIiwiIENhcmJvbk1vbk94aWRlICBWYWx1ZSBpcyAiICtfZGF0YSk7DQogICAgICAgICAgIH0NCiAgICAgICAgICAgZWxzZSANCiAgICAgICAgICAgew0KICAgICAgICAgICAgICAgc2VuZElGVFRUKGV2ZW50MSwgYXBpX2tleSwgIntDYXJib25Nb25PeGlkZSB2YWx1ZSAgSXMgdW5kZXIgY29udHJvbCA6ICIgK19kYXRhKTsNCiAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfTs=
    commands:
      - 'npm install amqplib'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
