metadata:
  name: mq7sensor
  labels:
    nuclio.io/project-name: 4798d392-983f-4de0-a6d4-068901fd56de
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-mq7sensor:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    mq7Trigger:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.1.181:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/sensors/mq7
  version: 1
  build:
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCdhbXFwbGliJyk7DQp2YXIgdXJsID0gcmVxdWlyZSgndXJsJyk7DQp2YXIgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKTsNCg0KbGV0IGV2ZW50bXE3ID0gIk1RN19UZWxlZ3JhbSI7IC8vIGluaXRpYXRpbmcgdGhlIHZhcmlhYmxlIGZvciB0aGUgZXZlbnQgY3JlYXRlZCBmb3IgdGhlIHVzYWdlIG9mIFRlbGVncmFtIG9uIElGVFRUDQpsZXQgYXBpX2tleSA9ICJlQjgwWnpfNnRPOXpBUnluMU15M3J0TUxDalFwLTFhQVVfTnc0Z0Fma0QwIjsgLy8gVXNpbmcgdGhlIGFwaSBrZXkgdG8gY29ubmVjdCB0aGlzIGNvZGUgdG8gd2ViaG9va3MgZm9yIGlmdHR0DQpsZXQgY2F1dGlvbiA9IHRydWU7DQoNCg0KICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2dnZXIobWVzc2FnZSl7ICAgIC8vIGNyZWF0ZWQgdGhlIGZ1bmN0aW9uIGluIHdoaWNoIGNvbm5lY3Rpb24sY2hhbm5lbCBhbmQgcXVldWUgYXJlIGluaXRpYXRlZCB0byBwYXNzIHRoZSB2YWx1ZXMgb24gcmFiYml0bXENCiAgICAgICAgICAgIHZhciBxdWV1ZSA9ICdpb3Qvc2Vuc29ycy9tcTcnOw0KICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IGF3YWl0IGFtcXAuY29ubmVjdCgnYW1xcDovL2d1ZXN0Omd1ZXN0QDE5Mi4xNjguMS4xODE6NTY3MicpOw0KICAgICAgICAgICAgY29uc3QgY2hhbm5lbCA9IGF3YWl0IGNvbm5lY3Rpb24uY3JlYXRlQ2hhbm5lbCgpOw0KICAgICAgICAgICAgYXdhaXQgY2hhbm5lbC5hc3NlcnRRdWV1ZShxdWV1ZSwge2R1cmFibGU6IGZhbHNlfSk7DQogICAgICAgICAgICBjaGFubmVsLnNlbmRUb1F1ZXVlKHF1ZXVlLCBCdWZmZXIuZnJvbShtZXNzYWdlKSk7DQogICAgICAgICB9DQoNCiAgICAgICAgIGxldCBzZW5kSUZUVFQgPSBhc3luYyBmdW5jdGlvbihldmVudCwga2V5LCB2YWx1ZTEsIHZhbHVlMiwgdmFsdWUzKXsgIC8vIGNyZWF0aW5nIGFuIGlmdHR0IGZ1bmN0aW9uIGFuZCBwYXNzaW5nIHRoZSBwYXJhbWV0ZXJzIGZvciBpdA0KICAgICAgICAgICAgdmFyIHBvc191cmwgPSBgaHR0cHM6Ly9tYWtlci5pZnR0dC5jb20vdHJpZ2dlci9NUTdfVGVsZWdyYW0vd2l0aC9rZXkvZUI4MFp6XzZ0Tzl6QVJ5bjFNeTNydE1MQ2pRcC0xYUFVX053NGdBZmtEMGA7DQogICAgICAgICAgICBsZXQgcG9zdERhdGEgPSBKU09OLnN0cmluZ2lmeSh7IHZhbHVlMSwgdmFsdWUyLCB2YWx1ZTMgfSk7DQoNCiAgICAgICAgICAgIHZhciBwYXJzZWRVcmwgPSB1cmwucGFyc2UocG9zX3VybCk7IC8vcGFyc2luZyB0aGUgVVJMIHRvIGNoZWNrIHRoZSBjb3JyZWN0IHBhdGggYW5kIHBvcnQgYXJlIGJlaW5nIHVzZWQNCiAgICAgICAgICAgIHZhciBwb3N0X29wdGlvbnMgPSB7DQogICAgICAgICAgICAgICAgaG9zdG5hbWU6IHBhcnNlZFVybC5ob3N0bmFtZSwNCiAgICAgICAgICAgICAgICBwb3J0OiBwYXJzZWRVcmwucG9ydCwNCiAgICAgICAgICAgICAgICBwYXRoOiBwYXJzZWRVcmwucGF0aCwNCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsDQogICAgICAgICAgICAgICAgICAgICdDb250ZW50LUxlbmd0aCc6IHBvc3REYXRhLmxlbmd0aA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07IA0KICAgICAgICAgICAgdmFyIHBvc3RfcmVxID0gaHR0cC5yZXF1ZXN0KHBvc3Rfb3B0aW9ucywgZnVuY3Rpb24ocmVzKSB7DQogICAgICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTsNCiAgICAgICAgICAgIHJlcy5vbignZGF0YScsIGZ1bmN0aW9uIChjaHVuaykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXNwb25zZTogJyArIGNodW5rKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBTZW5kIGEgUE9TVCByZXF1ZXN0IHRvIHRoZSB1cmwgd2l0aCB0aGUgYm9keS4uDQogICAgICAgIHBvc3RfcmVxLndyaXRlKHBvc3REYXRhKTsNCiAgICAgICAgcG9zdF9yZXEuZW5kKCk7DQogICAgfSAgIA0KDQogICAgICAgIGV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uKGNvbnRleHQsIGV2ZW50KSB7ICAvLyB1c2luZyB0aGUgZXhwb3J0IGhhbmRsZXIgdG8gbWFrZSB0aGUgZnVuY3Rpb24gc2VydmVybGVzcywgaS5lIGl0IHdpbGwgb25seSB3b3JrIG9yIG9wZXJhdGUgd2hlbiBhIGV2ZW50IGlzIG9jY3VyZWQgc28gbWFraW5nIGl0IGFuIGV2ZW50IGJhc2VkIGZ1bmN0aW9uDQogICAgICAgICAgICB2YXIgX29jY3VyYW5jZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2NjdXJhbmNlKSk7DQogICAgICAgICAgICB2YXIgX2luZm8gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLl9vY2N1cmFuY2UuYm9keS5pbmZvKTsNCg0KICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjaygicmVzcG9uc2UgIitfaW5mbyk7DQogICAgICAgICAgICBsb2dnZXIoIkNhcmJvbk1vbk94aWRlIFZhbHVlIDogIitfaW5mbyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgaWYoKF9pbmZvPjE1MCkpeyAgLy8gc2V0dGluZyB0aGUgY29uZGl0aW9uIGZvciB0aGUgaUZUVFQgdG8gc2V0IGEgdGhyZXNob2xkIHZhbHVlIGFuZCBwb3N0IHRoZSBtZXNzYWdlcyBvbiB0aGUgZGVzaXJlZCBwbGF0Zm9ybSB3aGVuIHRoZSB2YWx1ZSBoYXMgZ29uZSBwYXIgdGhlIHRocmVzaG9sZA0KICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBzZW5kSUZUVFQoZXZlbnRtcTcsIGFwaV9rZXksICJ7V2FybmluZzpWYWx1ZSBpcyBxdWl0ZSBIaWdoICIsIiBDYXJib25Nb25PeGlkZSAgVmFsdWUgaXMgIiArX2luZm8pOw0KICAgICAgICAgICB9DQogICAgICAgICAgIGVsc2UgDQogICAgICAgICAgIHsNCiAgICAgICAgICAgICAgIHNlbmRJRlRUVChldmVudG1xNywgYXBpX2tleSwgIntDYXJib25Nb25PeGlkZSB2YWx1ZSAgSXMgdW5kZXIgY29udHJvbCA6ICIgK19pbmZvKTsNCiAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfTs=
    commands:
      - 'npm install amqplib'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
